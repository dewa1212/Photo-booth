<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dewa Photo Booth Strip - Pro Edition</title>
    <!-- Link Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      /* --- CSS Starts Here --- */

      /* Import Font */
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Pacifico&display=swap");

      /* Reset Dasar & Box Sizing */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Poppins", sans-serif;
        background: radial-gradient(
          circle at top left,
          #fc5eff 0%,
          #6a82fb 100%
        );
        color: #333;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
        overflow-x: hidden;
        position: relative;
      }

      /* Particle Background */
      .particle {
        position: absolute;
        border-radius: 50%;
        opacity: 0.5;
        z-index: -1;
        animation: float 10s infinite ease-in-out;
      }

      @keyframes float {
        0% {
          transform: translateY(0) rotate(0deg);
        }
        50% {
          transform: translateY(-20px) rotate(180deg);
        }
        100% {
          transform: translateY(0) rotate(360deg);
        }
      }

      .booth-container {
        background-color: rgba(255, 255, 255, 0.95);
        padding: 30px 40px;
        border-radius: 24px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2),
          0 0 0 1px rgba(255, 255, 255, 0.1) inset,
          0 10px 30px rgba(255, 255, 255, 0.1) inset;
        width: 100%;
        max-width: 1100px;
        text-align: center;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        backdrop-filter: blur(10px);
        overflow: hidden;
        position: relative;
      }

      /* Container decoration */
      .booth-container::before {
        content: "";
        position: absolute;
        top: -10px;
        left: -10px;
        right: -10px;
        height: 10px;
        background: linear-gradient(
          90deg,
          #ff6b6b,
          #ffd166,
          #06d6a0,
          #118ab2,
          #073b4c
        );
        filter: blur(5px);
        opacity: 0.8;
      }

      /* State after load animation */
      body.loaded .booth-container {
        opacity: 1;
        transform: translateY(0);
      }

      header {
        margin-bottom: 28px;
        padding-bottom: 15px;
        border-bottom: 2px dashed #e8e8e8;
        position: relative;
      }

      header h1 {
        color: #3a3a3a;
        font-weight: 700;
        margin-bottom: 8px;
        font-size: 2.2rem;
        font-family: "Pacifico", cursive;
        text-shadow: 2px 2px 0px rgba(106, 130, 251, 0.2);
      }

      header h1 i {
        color: #fc5eff;
        margin-right: 12px;
        font-size: 1.8rem;
        animation: camera-flash 3s infinite;
      }

      @keyframes camera-flash {
        0% {
          opacity: 1;
          text-shadow: 0 0 0 transparent;
        }
        95% {
          opacity: 1;
          text-shadow: 0 0 0 transparent;
        }
        96% {
          opacity: 0.5;
          text-shadow: 0 0 20px #fc5eff;
        }
        97% {
          opacity: 1;
          text-shadow: 0 0 0 transparent;
        }
        99% {
          opacity: 0.5;
          text-shadow: 0 0 20px #fc5eff;
        }
        100% {
          opacity: 1;
          text-shadow: 0 0 0 transparent;
        }
      }

      header p {
        color: #666;
        font-size: 1.05rem;
        font-weight: 300;
      }

      /* Ribbon style */
      .ribbon {
        position: absolute;
        top: -10px;
        right: -40px;
        background: #fc5eff;
        color: white;
        padding: 5px 40px;
        transform: rotate(45deg);
        font-size: 0.8rem;
        font-weight: bold;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        z-index: 1;
      }

      /* Area Utama (Side-by-Side) */
      main {
        display: flex;
        gap: 30px;
        align-items: flex-start;
      }

      /* Area Kamera (Kiri) */
      .booth-area {
        flex: 3;
        min-width: 0;
        position: relative;
      }

      /* Area Hasil (Kanan) */
      .strip-result-area {
        flex: 2;
        min-width: 0;
        background: linear-gradient(145deg, #f9f9f9, #f0f0f0);
        padding: 20px;
        border-radius: 18px;
        border: 1px solid #eee;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05),
          0 4px 6px -2px rgba(0, 0, 0, 0.03),
          inset 0 2px 4px rgba(0, 0, 0, 0.04);
        opacity: 0;
        transform: translateX(50px);
        transition: all 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
        visibility: hidden;
      }

      /* State after slide-in animation */
      .strip-result-area.active {
        opacity: 1;
        transform: translateX(0);
        visibility: visible;
      }

      .video-wrapper {
        position: relative;
        margin-bottom: 25px;
        background-color: #111;
        border-radius: 18px;
        overflow: hidden;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15),
          0 0 0 1px rgba(255, 255, 255, 0.1) inset;
        border: 4px solid #f7f7f7;
        transition: all 0.3s ease;
      }

      .video-wrapper:hover {
        transform: scale(1.01);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      }

      .video-wrapper::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 20px;
        background: rgba(255, 255, 255, 0.1);
        z-index: 2;
        pointer-events: none;
      }

      .video-wrapper::after {
        content: "";
        position: absolute;
        top: 10px;
        right: 10px;
        width: 10px;
        height: 10px;
        background: #fc5eff;
        border-radius: 50%;
        box-shadow: 0 0 10px #fc5eff;
        z-index: 2;
        animation: blink 2s infinite;
      }

      @keyframes blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.3;
        }
      }

      #video {
        display: block;
        width: 100%;
        height: auto;
        border-radius: 12px;
        transform: scaleX(-1);
        transition: filter 0.3s ease;
      }

      /* Fun filter indicator */
      .filter-label {
        position: absolute;
        bottom: 15px;
        left: 15px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        z-index: 5;
        display: flex;
        align-items: center;
        gap: 5px;
        opacity: 0.7;
      }

      .feedback-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
        z-index: 10;
        border-radius: 14px;
      }

      .feedback-overlay.show {
        opacity: 1;
      }

      #feedback-text {
        font-size: 4.5rem;
        color: white;
        font-weight: bold;
        text-shadow: 0 0 20px rgba(252, 94, 255, 0.8);
        animation: pulse-text 1s infinite alternate;
      }

      @keyframes pulse-text {
        from {
          transform: scale(1);
        }
        to {
          transform: scale(1.05);
        }
      }

      .flash-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: white;
        opacity: 0;
        transition: opacity 0.1s ease-out;
        pointer-events: none;
        z-index: 20;
        border-radius: 14px;
      }

      .flash-overlay.flash {
        opacity: 0.9;
      }

      .controls {
        margin-top: 20px;
        margin-bottom: 15px;
      }

      .progress-info {
        color: #555;
        font-size: 1rem;
        margin-top: 15px;
        font-weight: 500;
        background: rgba(252, 94, 255, 0.1);
        display: inline-block;
        padding: 8px 16px;
        border-radius: 30px;
        transition: all 0.3s ease;
      }

      .btn {
        padding: 12px 28px;
        font-size: 1rem;
        font-weight: 600;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 5px;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
        position: relative;
        overflow: hidden;
      }

      .btn::after {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.3) 0%,
          transparent 70%
        );
        opacity: 0;
        transition: opacity 0.3s;
        pointer-events: none;
      }

      .btn:hover::after {
        opacity: 1;
      }

      .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 7px 14px rgba(0, 0, 0, 0.18);
      }

      .btn:active {
        transform: translateY(-1px);
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
      }

      .btn-primary {
        background: linear-gradient(135deg, #fc5eff, #6a82fb);
        color: white;
      }

      .btn-primary:hover {
        background: linear-gradient(135deg, #e343e3, #5a70e7);
      }

      .btn-pulse {
        animation: pulse-btn 2.5s infinite;
      }

      @keyframes pulse-btn {
        0% {
          transform: scale(1);
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
        }
        50% {
          transform: scale(1.05);
          box-shadow: 0 8px 20px rgba(252, 94, 255, 0.3);
        }
        100% {
          transform: scale(1);
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
        }
      }

      .btn-pulse:hover {
        animation-play-state: paused;
      }

      .btn-secondary {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        color: #495057;
        border: 1px solid #ced4da;
      }

      .btn-secondary:hover {
        background: linear-gradient(135deg, #e9ecef, #dee2e6);
        color: #212529;
      }

      .btn-tertiary {
        background-color: transparent;
        color: #6a82fb;
        border: 1px solid #6a82fb;
      }

      .btn-tertiary:hover {
        background-color: rgba(106, 130, 251, 0.1);
        color: #5570e7;
      }

      /* Style menu option */
      .filter-menu {
        margin-top: 10px;
        display: flex;
        justify-content: center;
        gap: 8px;
      }

      .filter-option {
        padding: 6px 12px;
        background: #f0f0f0;
        border-radius: 20px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.2s ease;
        border: 1px solid transparent;
      }

      .filter-option:hover {
        background: #e6e6e6;
      }

      .filter-option.active {
        background: rgba(252, 94, 255, 0.15);
        border-color: rgba(252, 94, 255, 0.3);
        color: #fc5eff;
        font-weight: 500;
      }

      /* Area Hasil Strip Styling */
      .strip-result-area h2 {
        margin-bottom: 18px;
        color: #444;
        font-weight: 600;
        font-size: 1.3rem;
        position: relative;
        display: inline-block;
      }

      .strip-result-area h2::after {
        content: "";
        position: absolute;
        bottom: -5px;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(90deg, #fc5eff, #6a82fb);
        border-radius: 3px;
      }

      .strip-wrapper {
        margin-bottom: 20px;
        padding: 8px;
        background-color: #fff;
        border: 1px solid #ddd;
        border-radius: 10px;
        display: inline-block;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08),
          0 0 0 1px rgba(255, 255, 255, 0.1) inset;
        min-height: 150px;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
      }

      .strip-wrapper::before {
        content: "";
        position: absolute;
        top: -2px;
        left: 20px;
        right: 20px;
        height: 4px;
        background: #fc5eff;
        border-radius: 4px;
      }

      .loading-placeholder {
        color: #888;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 20px;
        border-radius: 30px;
        background: rgba(0, 0, 0, 0.03);
      }

      #photo-strip {
        display: block;
        max-width: 100%;
        height: auto;
        border-radius: 6px;
        max-height: 55vh;
        object-fit: contain;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
      }

      #photo-strip:hover {
        transform: scale(1.02);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.12);
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
      }

      footer {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 2px dashed #e8e8e8;
        font-size: 0.9rem;
        color: #888;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
      }

      footer a {
        color: #6a82fb;
        text-decoration: none;
        transition: all 0.2s ease;
      }

      footer a:hover {
        color: #fc5eff;
      }

      .heart {
        color: #fc5eff;
        animation: heartbeat 1.5s infinite;
        display: inline-block;
      }

      @keyframes heartbeat {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.15);
        }
      }

      /* Confetti Effect for Complete */
      .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        opacity: 0;
        transform: translateY(0) rotate(0deg);
        pointer-events: none;
        z-index: 999;
      }

      /* Responsiveness - Stack layout on smaller screens */
      @media (max-width: 900px) {
        main {
          flex-direction: column;
          gap: 25px;
        }

        .booth-area,
        .strip-result-area {
          flex-basis: auto;
          width: 100%;
        }

        .strip-result-area {
          transform: translateY(30px);
        }

        .strip-result-area.active {
          transform: translateY(0);
        }

        #photo-strip {
          max-height: none;
        }

        #feedback-text {
          font-size: 3.5rem;
        }

        .ribbon {
          display: none;
        }
      }

      @media (max-width: 600px) {
        .booth-container {
          padding: 20px 15px;
        }

        header h1 {
          font-size: 1.8rem;
        }

        .btn {
          padding: 10px 20px;
          font-size: 0.95rem;
        }

        .filter-menu {
          flex-wrap: wrap;
        }

        #feedback-text {
          font-size: 2.8rem;
        }
      }

      /* Print Styles untuk Strip */
      @media print {
        body {
          background: none;
          padding: 0;
          margin: 0;
          color: #000;
          display: block;
          -webkit-print-color-adjust: exact !important;
          print-color-adjust: exact !important;
        }

        /* Sembunyikan semua KECUALI hasil strip */
        .booth-container > *:not(main),
        main > *:not(.strip-result-area),
        .strip-result-area > *:not(.strip-wrapper),
        .strip-wrapper > *:not(#photo-strip),
        .booth-area,
        header,
        footer,
        .actions,
        .loading-placeholder,
        .strip-result-area h2 {
          display: none !important;
          visibility: hidden !important;
        }

        .booth-container,
        main {
          box-shadow: none;
          border: none;
          padding: 0;
          margin: 0;
          width: 100%;
          max-width: 100%;
        }

        .strip-result-area {
          display: block !important;
          visibility: visible !important;
          opacity: 1 !important;
          position: static !important;
          padding: 0;
          margin: 0;
          box-shadow: none;
          border: none;
          width: 100%;
          text-align: center;
          background: none;
          page-break-before: auto;
          page-break-inside: avoid;
        }

        .strip-wrapper {
          display: inline-block !important;
          visibility: visible !important;
          border: none;
          padding: 0;
          margin: 0 auto;
          box-shadow: none;
          background: none;
          width: auto;
          max-width: 100%;
        }

        .strip-wrapper::before {
          display: none;
        }

        #photo-strip {
          display: block !important;
          visibility: visible !important;
          max-width: 100% !important;
          width: auto;
          height: auto !important;
          max-height: 95vh;
          border-radius: 0;
          margin: 0 auto;
          page-break-inside: avoid;
          object-fit: contain;
          box-shadow: none;
        }
      }
      /* --- CSS Ends Here --- */
    </style>
  </head>
  <body>
    <!-- Dynamic Particles for Background -->
    <div id="particles-container"></div>

    <!-- Container Utama -->
    <div class="booth-container">
      <div class="ribbon">Pro Edition</div>
      <header>
        <h1><i class="fas fa-camera-retro"></i> Dewa Photo Booth</h1>
        <p>Buat kenangan seru dengan 4 jepretan lucu dalam strip foto!</p>
      </header>

      <main>
        <!-- Area Kamera (Sebelah Kiri) -->
        <div class="booth-area" id="booth-area">
          <div class="video-wrapper">
            <video id="video" autoplay playsinline>
              Video stream tidak tersedia.
            </video>
            <div class="filter-label">
              <i class="fas fa-magic"></i>
              <span id="current-filter">Normal</span>
            </div>
            <div id="feedback-overlay" class="feedback-overlay">
              <span id="feedback-text"></span>
            </div>
            <div id="flash-overlay" class="flash-overlay"></div>
          </div>

          <!-- Canvas Tersembunyi -->
          <canvas id="capture-canvas" style="display: none"></canvas>
          <canvas id="strip-canvas" style="display: none"></canvas>

          <div class="filter-menu">
            <div class="filter-option active" data-filter="normal">Normal</div>
            <div class="filter-option" data-filter="vintage">Vintage</div>
            <div class="filter-option" data-filter="grayscale">B&W</div>
            <div class="filter-option" data-filter="sepia">Sepia</div>
            <div class="filter-option" data-filter="funky">Funky</div>
          </div>

          <div class="controls">
            <button id="capture-btn" class="btn btn-primary btn-pulse">
              <i class="fas fa-camera"></i> Mulai Foto Strip
            </button>
            <div id="progress-info" class="progress-info" style="display: none">
              Foto <span id="current-photo-count">0</span> dari
              <span id="total-photo-count">4</span>
            </div>
          </div>
        </div>

        <!-- Area Hasil Strip Foto (Sebelah Kanan) -->
        <div class="strip-result-area" id="strip-result-area">
          <h2>Hasil Jepretanmu:</h2>
          <div class="strip-wrapper">
            <div id="loading-strip" class="loading-placeholder">
              <i class="fas fa-spinner fa-spin"></i> Menciptakan karya senimu...
            </div>
            <img
              id="photo-strip"
              alt="Hasil Photo Strip Anda"
              style="display: none"
            />
          </div>
          <div class="actions">
            <button id="print-btn" class="btn btn-secondary" disabled>
              <i class="fas fa-print"></i> Cetak
            </button>
            <button id="save-btn" class="btn btn-secondary" disabled>
              <i class="fas fa-download"></i> Simpan
            </button>
            <button id="retake-btn" class="btn btn-tertiary">
              <i class="fas fa-redo"></i> Ulangi
            </button>
          </div>
        </div>
      </main>

      <footer>
        <p>
          © 2025 Creative Photo Studios <span class="heart">♥</span>
          <a href="#">DewaPhoto</a>
        </p>
      </footer>
    </div>

    <script>
      // --- JavaScript Starts Here ---

      document.addEventListener("DOMContentLoaded", () => {
        // --- Konfigurasi ---
        const PHOTOS_PER_STRIP = 4;
        const COUNTDOWN_TIME = 3;
        const DELAY_BETWEEN_PHOTOS = 1500;

        // --- Elemen DOM ---
        const video = document.getElementById("video");
        const captureCanvas = document.getElementById("capture-canvas");
        const stripCanvas = document.getElementById("strip-canvas");
        const photoStripElement = document.getElementById("photo-strip");
        const captureBtn = document.getElementById("capture-btn");
        const printBtn = document.getElementById("print-btn");
        const saveBtn = document.getElementById("save-btn");
        const retakeBtn = document.getElementById("retake-btn");
        const currentFilterLabel = document.getElementById("current-filter");

        const boothArea = document.getElementById("booth-area");
        const stripResultArea = document.getElementById("strip-result-area");
        const feedbackOverlay = document.getElementById("feedback-overlay");
        const feedbackText = document.getElementById("feedback-text");
        const flashOverlay = document.getElementById("flash-overlay");
        const progressInfo = document.getElementById("progress-info");
        const currentPhotoCountSpan = document.getElementById(
          "current-photo-count"
        );
        const totalPhotoCountSpan =
          document.getElementById("total-photo-count");
        const loadingStrip = document.getElementById("loading-strip");
        const boothContainer = document.querySelector(".booth-container");
        const filterOptions = document.querySelectorAll(".filter-option");

        // --- State Aplikasi ---
        let stream = null;
        let capturedPhotosData = [];
        let currentStripDataUrl = null;
        let isCapturing = false;
        let currentFilter = "normal";

        // --- Inisialisasi ---
        async function initializeWebcam() {
          try {
            stream = await navigator.mediaDevices.getUserMedia({
              video: {
                width: { ideal: 1280 },
                height: { ideal: 720 },
                facingMode: "user",
              },
              audio: false,
            });
            video.srcObject = stream;
            await video.play();
            console.log("Webcam siap.");
            captureBtn.disabled = false;
            captureBtn.classList.add("btn-pulse");
          } catch (err) {
            console.error("Error webcam: ", err);
            feedbackText.textContent = "Error Webcam!";
            feedbackOverlay.classList.add("show");
            captureBtn.disabled = true;
            captureBtn.textContent = "Webcam Error";
            captureBtn.classList.remove("btn-pulse");
            alert("Tidak bisa akses webcam. Cek izin & aplikasi lain.");
          }
        }

        // --- Animasi Load & Particles ---
        function triggerLoadAnimation() {
          // Tambahkan kelas setelah sedikit delay agar transisi CSS terpicu
          setTimeout(() => {
            document.body.classList.add("loaded");
            createParticles();
          }, 100); // 100ms delay
        }

        // Buat particle untuk background yang menarik
        function createParticles() {
          const particlesContainer = document.getElementById(
            "particles-container"
          );
          const colors = [
            "#FC5EFF",
            "#6A82FB",
            "#FFD166",
            "#06D6A0",
            "#118AB2",
          ];

          for (let i = 0; i < 15; i++) {
            const particle = document.createElement("div");
            particle.classList.add("particle");

            // Atur atribut random
            const size = Math.random() * 25 + 5;
            const color = colors[Math.floor(Math.random() * colors.length)];
            const left = Math.random() * 100;
            const delay = Math.random() * 10;
            const duration = Math.random() * 10 + 10;

            // Terapkan style
            particle.style.width = `${size}px`;
            particle.style.height = `${size}px`;
            particle.style.backgroundColor = color;
            particle.style.left = `${left}%`;
            particle.style.top = `${Math.random() * 100}%`;
            particle.style.opacity = `${Math.random() * 0.5 + 0.1}`;
            particle.style.animationDelay = `${delay}s`;
            particle.style.animationDuration = `${duration}s`;

            particlesContainer.appendChild(particle);
          }
        }

        // --- Filter Video ---
        // Terapkan filter ke video
        function applyFilter(filterName) {
          currentFilter = filterName;
          currentFilterLabel.textContent =
            filterName.charAt(0).toUpperCase() + filterName.slice(1);

          // Reset semua filter
          video.style.filter = "";

          // Terapkan filter yang dipilih
          switch (filterName) {
            case "vintage":
              video.style.filter = "sepia(0.5) contrast(1.2) brightness(0.9)";
              break;
            case "grayscale":
              video.style.filter = "grayscale(1)";
              break;
            case "sepia":
              video.style.filter = "sepia(0.8)";
              break;
            case "funky":
              video.style.filter =
                "saturate(1.8) hue-rotate(30deg) contrast(1.1)";
              break;
            default:
              // Normal - tidak ada filter
              break;
          }
        }

        // --- Fungsi Pengambilan Foto ---
        function startCaptureSequence() {
          if (isCapturing) return;
          isCapturing = true;
          capturedPhotosData = [];
          currentStripDataUrl = null;
          captureBtn.disabled = true;
          captureBtn.classList.remove("btn-pulse");
          printBtn.disabled = true;
          saveBtn.disabled = true;
          retakeBtn.disabled = true;
          progressInfo.style.display = "block";
          totalPhotoCountSpan.textContent = PHOTOS_PER_STRIP;
          currentPhotoCountSpan.textContent = "0";
          stripResultArea.classList.remove("active");

          // Animasi untuk tombol mulai
          captureBtn.innerHTML =
            '<i class="fas fa-spinner fa-spin"></i> Sedang Berjalan...';

          capturePhotoWithCountdown(1);
        }

        function capturePhotoWithCountdown(photoNumber) {
          currentPhotoCountSpan.textContent = photoNumber;
          let count = COUNTDOWN_TIME;
          feedbackText.textContent = count;
          feedbackOverlay.classList.add("show");

          // Atur pesan khusus untuk setiap foto
          let specialPoseMessages = [
            "Pose Normal!",
            "Pose Lucu!",
            "Pose Keren!",
            "Pose Gila!",
          ];

          const countdownInterval = setInterval(() => {
            count--;
            if (count > 0) {
              feedbackText.textContent = count;
            } else if (count === 0) {
              feedbackText.textContent =
                specialPoseMessages[photoNumber - 1] || "CHEESE!";
            } else {
              clearInterval(countdownInterval);
              feedbackOverlay.classList.remove("show");
              captureSingleFrame(photoNumber);

              if (photoNumber < PHOTOS_PER_STRIP) {
                setTimeout(
                  () => capturePhotoWithCountdown(photoNumber + 1),
                  DELAY_BETWEEN_PHOTOS
                );
              } else {
                console.log("Selesai, membuat strip...");
                progressInfo.style.display = "none";
                captureBtn.innerHTML =
                  '<i class="fas fa-camera"></i> Mulai Foto Strip';
                generatePhotoStrip();
                celebrateCompletion();
              }
            }
          }, 1000);
        }

        function captureSingleFrame(photoNumber) {
          flashOverlay.classList.add("flash");
          setTimeout(() => flashOverlay.classList.remove("flash"), 150);

          const context = captureCanvas.getContext("2d");
          captureCanvas.width = video.videoWidth;
          captureCanvas.height = video.videoHeight;

          // Flip kamera selfie dan terapkan efek
          context.translate(captureCanvas.width, 0);
          context.scale(-1, 1);
          context.drawImage(
            video,
            0,
            0,
            captureCanvas.width,
            captureCanvas.height
          );
          context.setTransform(1, 0, 0, 1, 0, 0);

          // Terapkan filter yang sama seperti video jika dipilih
          if (currentFilter !== "normal") {
            // Simpan state
            context.save();

            // Terapkan filter sesuai pilihan
            switch (currentFilter) {
              case "vintage":
                context.filter = "sepia(0.5) contrast(1.2) brightness(0.9)";
                break;
              case "grayscale":
                context.filter = "grayscale(1)";
                break;
              case "sepia":
                context.filter = "sepia(0.8)";
                break;
              case "funky":
                context.filter =
                  "saturate(1.8) hue-rotate(30deg) contrast(1.1)";
                break;
            }

            // Gambar ulang dengan filter
            context.drawImage(captureCanvas, 0, 0);

            // Kembalikan state
            context.restore();
          }

          const dataUrl = captureCanvas.toDataURL("image/png");
          capturedPhotosData.push(dataUrl);
          console.log(`Foto ${photoNumber} captured.`);
        }

        // --- Fungsi Pembuatan Strip ---
        async function generatePhotoStrip() {
          if (capturedPhotosData.length !== PHOTOS_PER_STRIP) {
            console.error("Jumlah foto tidak sesuai.");
            resetCaptureProcess();
            alert("Error pengambilan foto. Coba lagi.");
            return;
          }

          // Tampilkan area hasil DENGAN loading
          stripResultArea.classList.add("active");
          loadingStrip.style.display = "flex";
          photoStripElement.style.display = "none";

          // Buat array frasa lucu untuk ditampilkan saat loading
          const funnyLoadingPhrases = [
            "<i class='fas fa-spinner fa-spin'></i> Menyusun kenangan indahmu...",
            "<i class='fas fa-spinner fa-spin'></i> Menciptakan karya senimu...",
            "<i class='fas fa-spinner fa-spin'></i> Memproses senyuman menawanmu...",
            "<i class='fas fa-spinner fa-spin'></i> Menggabungkan momen ajaibmu...",
          ];

          // Pilih frasa random
          loadingStrip.innerHTML =
            funnyLoadingPhrases[
              Math.floor(Math.random() * funnyLoadingPhrases.length)
            ];

          const stripCtx = stripCanvas.getContext("2d");
          const images = [];
          let loadedImages = 0;
          let photoWidth = 0,
            photoHeight = 0;

          // Load gambar
          for (const dataUrl of capturedPhotosData) {
            const img = new Image();
            images.push(img);
            img.src = dataUrl;
            try {
              await img.decode();
              if (loadedImages === 0) {
                photoWidth = img.naturalWidth;
                photoHeight = img.naturalHeight;
              }
              loadedImages++;
            } catch (error) {
              console.error("Gagal load gambar:", error);
              resetCaptureProcess();
              alert("Gagal proses gambar. Coba lagi.");
              return;
            }
          }

          if (loadedImages !== PHOTOS_PER_STRIP || photoWidth === 0) {
            console.error("Load gambar gagal / dimensi 0.");
            resetCaptureProcess();
            alert("Error proses gambar. Coba lagi.");
            return;
          }

          // Buat strip dengan style yang lebih menarik
          const padding = Math.round(photoWidth * 0.04); // Padding lebih besar
          const borderRadius = Math.round(photoWidth * 0.02); // Border radius gambar
          const borderSize = Math.round(photoWidth * 0.01); // Ukuran border gambar
          const stripPadding = Math.round(photoWidth * 0.06); // Padding strip keseluruhan

          // Buat canvas dengan dimensi yang sesuai
          stripCanvas.width = photoWidth + stripPadding * 2;
          stripCanvas.height =
            photoHeight * PHOTOS_PER_STRIP +
            padding * (PHOTOS_PER_STRIP + 1) +
            stripPadding * 2;

          // Isi background strip dengan gradient
          const gradient = stripCtx.createLinearGradient(
            0,
            0,
            0,
            stripCanvas.height
          );
          gradient.addColorStop(0, "#ffffff");
          gradient.addColorStop(1, "#f8f9fa");
          stripCtx.fillStyle = gradient;
          stripCtx.fillRect(0, 0, stripCanvas.width, stripCanvas.height);

          // Tambahkan header strip
          stripCtx.fillStyle = "rgba(252, 94, 255, 0.1)";
          stripCtx.fillRect(0, 0, stripCanvas.width, stripPadding * 1.5);
          stripCtx.font = "bold 20px Poppins, sans-serif";
          stripCtx.fillStyle = "#FC5EFF";
          stripCtx.textAlign = "center";
          stripCtx.fillText(
            "Dewa-Photo-Booth",
            stripCanvas.width / 2,
            stripPadding
          );

          // Tambahkan tanggal
          const today = new Date();
          stripCtx.font = "16px Poppins, sans-serif";
          stripCtx.fillStyle = "#6A82FB";
          stripCtx.fillText(
            today.toLocaleDateString(),
            stripCanvas.width / 2,
            stripPadding * 1.3
          );

          // Gambar foto-foto dengan efek dan border
          let currentY = stripPadding + padding;

          for (let i = 0; i < images.length; i++) {
            const img = images[i];

            // Tambahkan shadow untuk foto
            stripCtx.shadowColor = "rgba(0, 0, 0, 0.15)";
            stripCtx.shadowBlur = 8;
            stripCtx.shadowOffsetX = 0;
            stripCtx.shadowOffsetY = 3;

            // Gambar background foto (untuk border)
            stripCtx.fillStyle = "#fff";
            stripCtx.fillRect(
              stripPadding - borderSize,
              currentY - borderSize,
              photoWidth + borderSize * 2,
              photoHeight + borderSize * 2
            );

            // Reset shadow untuk gambar foto
            stripCtx.shadowColor = "transparent";

            // Gambar foto
            stripCtx.drawImage(
              img,
              stripPadding,
              currentY,
              photoWidth,
              photoHeight
            );

            // Tambahkan nomor foto kecil di pojok
            stripCtx.fillStyle = "rgba(255, 255, 255, 0.8)";
            stripCtx.beginPath();
            stripCtx.arc(stripPadding + 25, currentY + 25, 15, 0, Math.PI * 2);
            stripCtx.fill();

            stripCtx.font = "bold 16px Poppins, sans-serif";
            stripCtx.fillStyle = "#FC5EFF";
            stripCtx.textAlign = "center";
            stripCtx.textBaseline = "middle";
            stripCtx.fillText(
              (i + 1).toString(),
              stripPadding + 25,
              currentY + 25
            );

            currentY += photoHeight + padding;
          }

          // Tambahkan footer strip
          stripCtx.fillStyle = "rgba(106, 130, 251, 0.1)";
          stripCtx.fillRect(
            0,
            stripCanvas.height - stripPadding,
            stripCanvas.width,
            stripPadding
          );
          stripCtx.font = "14px Poppins, sans-serif";
          stripCtx.fillStyle = "#6A82FB";
          stripCtx.textAlign = "center";
          stripCtx.fillText(
            "www.funphotobooth.com",
            stripCanvas.width / 2,
            stripCanvas.height - stripPadding * 0.4
          );

          currentStripDataUrl = stripCanvas.toDataURL("image/png");
          photoStripElement.src = currentStripDataUrl;
          console.log("Strip dibuat.");

          // Update UI setelah strip jadi
          loadingStrip.style.display = "none";
          photoStripElement.style.display = "block";
          printBtn.disabled = false;
          saveBtn.disabled = false;
          retakeBtn.disabled = false;
          isCapturing = false;
        }

        // --- Efek Konfeti Perayaan ---
        function celebrateCompletion() {
          const colors = [
            "#FC5EFF",
            "#6A82FB",
            "#FFD166",
            "#06D6A0",
            "#118AB2",
          ];

          for (let i = 0; i < 80; i++) {
            setTimeout(() => {
              const confetti = document.createElement("div");
              confetti.classList.add("confetti");

              // Acak properti konfeti
              const size = Math.random() * 10 + 5;
              const color = colors[Math.floor(Math.random() * colors.length)];
              const left = Math.random() * 100;

              // Atur style
              confetti.style.width = `${size}px`;
              confetti.style.height = `${size}px`;
              confetti.style.backgroundColor = color;
              confetti.style.left = `${left}%`;
              confetti.style.top = `-10px`;

              // Tambahkan ke DOM
              document.body.appendChild(confetti);

              // Animasi jatuh
              const fallAnimation = confetti.animate(
                [
                  {
                    transform: "translateY(0) rotate(0deg)",
                    opacity: 1,
                  },
                  {
                    transform: `translateY(${window.innerHeight}px) rotate(${
                      Math.random() * 360
                    }deg)`,
                    opacity: 0,
                  },
                ],
                {
                  duration: Math.random() * 2000 + 2000,
                  easing: "cubic-bezier(0.2, 0.8, 0.2, 1)",
                }
              );

              // Hapus setelah animasi selesai
              fallAnimation.onfinish = () => {
                confetti.remove();
              };
            }, Math.random() * 2000); // Delay acak
          }
        }

        // --- Fungsi Reset ---
        function resetCaptureProcess() {
          isCapturing = false;
          capturedPhotosData = [];
          currentStripDataUrl = null;
          captureBtn.disabled = false;
          captureBtn.classList.add("btn-pulse");
          captureBtn.innerHTML =
            '<i class="fas fa-camera"></i> Mulai Foto Strip';
          printBtn.disabled = true;
          saveBtn.disabled = true;
          retakeBtn.disabled = false;
          progressInfo.style.display = "none";
          stripResultArea.classList.remove("active");
          setTimeout(() => {
            loadingStrip.style.display = "flex";
            photoStripElement.style.display = "none";
          }, 500);
        }

        // --- Fungsi Aksi Tombol ---
        function printPhotoStrip() {
          if (!currentStripDataUrl) return;
          window.print();
        }

        function savePhotoStrip() {
          if (!currentStripDataUrl) return;
          const link = document.createElement("a");
          link.href = currentStripDataUrl;
          const timestamp = new Date().toISOString().replace(/[:.-]/g, "");
          link.download = `funphoto_strip_${timestamp}.png`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        }

        function retakePhoto() {
          resetCaptureProcess();
        }

        // --- Event Listeners ---
        captureBtn.addEventListener("click", startCaptureSequence);
        printBtn.addEventListener("click", printPhotoStrip);
        saveBtn.addEventListener("click", savePhotoStrip);
        retakeBtn.addEventListener("click", retakePhoto);

        // Event listener untuk filter options
        filterOptions.forEach((option) => {
          option.addEventListener("click", function () {
            // Remove active class from all options
            filterOptions.forEach((opt) => opt.classList.remove("active"));
            // Add active class to clicked option
            this.classList.add("active");
            // Apply selected filter
            applyFilter(this.dataset.filter);
          });
        });

        // --- Mulai Aplikasi ---
        captureBtn.disabled = true;
        initializeWebcam();
        triggerLoadAnimation();
      });
    </script>
  </body>
</html>
